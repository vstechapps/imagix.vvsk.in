import{d as ct}from"./chunk-IMPBB4AK.js";var Xt=ct((Wt,ut)=>{var I=function(i,e){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},I(i,e)};function d(i,e){I(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var f=function(){return f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},f.apply(this,arguments)};function g(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(l){try{u(r.next(l))}catch(v){a(v)}}function h(l){try{u(r.throw(l))}catch(v){a(v)}}function u(l){l.done?o(l.value):n(l.value).then(s,h)}u((r=r.apply(i,e||[])).next())})}function b(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return h([u,l])}}function h(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=u[0]&2?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(l){u=[6,l],n=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var ht=(function(){function i(e,t){t===void 0&&(t=void 0),this.replacement=e,this.message=t}return i.prototype.toString=function(){var e="";return this.replacement&&(e+="Use ".concat(this.replacement," instead.")),this.message&&(e+=" ".concat(this.message)),e},i})(),x={},J=(function(){function i(e){this._parts=e.split(".")}return i.prototype.contains=function(e){if(e._parts.length>this._parts.length)return!1;for(var t=0;t<e._parts.length;t++)if(e._parts[t]!==this._parts[t])return!1;return!0},i.prototype.toString=function(){return this._parts.join(".")},i})();function _(i,e,t){t===void 0&&(t=void 0),x[i]=new ht(e,t)}function ft(i,e,t){var r=function(n){Z(i,r),t(n)};U(i,e,r)}function dt(i,e,t){m.has(i)||m.set(i,[]),m.get(i).push({type:new J(e),listener:t})}function U(i,e,t,r){r===void 0&&(r={}),Object.keys(x).includes(e)&&console.warn("Event ".concat(e," is deprecated. ").concat(x[e])),r.once?ft(i,e,t):dt(i,e,t)}function Z(i,e){if(!m.has(i)||!m.get(i).map(function(r){return r.listener}).includes(e))throw new Error("No matching event listener to remove");var t=m.get(i).filter(function(r){return r.listener!==e});m.set(i,t)}function q(i,e,t){t.target=i,t.type=e;var r=new J(e);if(!m.has(i))return null;for(var n=[],o=0;o<m.get(i).length;o++){var a=m.get(i)[o];r.contains(a.type)&&n.push(a.listener)}for(var o=0;o<n.length;o++){var s=n[o];s(t)}return t}function p(i,e,t){if(Object.keys(x).includes(e)&&x[e].replacement)throw new Error("Event ".concat(e," is deprecated. ").concat(x[e]));for(var r in x){var n=x[r];e===n.replacement&&q(i,r,f({},t))}return q(i,e,t)}var m=new WeakMap,lt=Object.freeze({__proto__:null,deprecate:_,subscribe:U,unsubscribe:Z,publish:p});function pt(i,e){do{var t=Object.getOwnPropertyDescriptor(i,e);if(t)return t;i=Object.getPrototypeOf(i)}while(i)}function S(i,e){var t=e.getDefaultOptions();for(var r in i)if(!t.hasOwnProperty(r))throw new Error("Invalid option: '"+r+"'");i=f(f({},t),i);for(var r in i){var n=pt(e,r);(!n||n.set)&&(e[r]=i[r])}}var E=new WeakMap;function vt(i,e,t){E.has(i.movie)||E.set(i.movie,new WeakMap);var r=E.get(i.movie);r.has(i)||r.set(i,{});var n=r.get(i);return n[e]=t,t}function mt(i,e){return E.has(i.movie)&&E.get(i.movie).has(i)&&e in E.get(i.movie).get(i)}function yt(i,e){return E.get(i.movie).get(i)[e]}function Q(i){E.delete(i)}var tt=(function(){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.value=e,this.interpolationKeys=[]}return i.prototype.withKeys=function(e){return this.interpolationKeys=e,this},i.prototype.evaluate=function(e){if(this.value.length===0)throw new Error("Empty keyframe");if(e===void 0)throw new Error("|time| is undefined or null");var t=this.value[0][0];if(e<t)throw new Error("No keyframe point before |time|");for(var r=0;r<this.value.length;r++){var n=this.value[r][0],o=this.value[r][1],a=this.value[r].length===3?this.value[r][2]:B;if(r+1<this.value.length){var s=this.value[r+1][0],h=this.value[r+1][1];if(n<=e&&e<s)if(typeof o=="number"||typeof h=="object"){if(typeof o!=typeof h)throw new Error("Type mismatch in keyframe values");var u=(e-n)/(s-n);return a(o,h,u,this.interpolationKeys)}else return o}else return o}},i})();function c(i,e,t){if(mt(i,e))return yt(i,e);for(var r=e.split("."),n=i[r.shift()];r.length>0;)n=n[r.shift()];var o=i.propertyFilters[e],a;return n instanceof tt?a=n.evaluate(t):typeof n=="function"?a=n(i,t):a=n,vt(i,e,o?o.call(i,a):a)}function B(i,e,t,r){if(typeof i!=typeof e)throw new Error("Type mismatch");if(typeof i!="number"&&typeof i!="object")return i;if(typeof i=="object"){if(Object.getPrototypeOf(i)!==Object.getPrototypeOf(e))throw new Error("Prototype mismatch");for(var n=Object.create(Object.getPrototypeOf(i)),o=Object.keys(i)||r,a=0;a<o.length;a++){var s=o[a];!i.hasOwnProperty(s)||!e.hasOwnProperty(s)||(n[s]=B(i[s],e[s],t))}return n}return(1-t)*i+t*e}function et(i,e,t,r){if(typeof i!=typeof e)throw new Error("Type mismatch");if(typeof i!="number"&&typeof i!="object")return i;if(typeof i=="object"&&typeof e=="object"){if(Object.getPrototypeOf(i)!==Object.getPrototypeOf(e))throw new Error("Prototype mismatch");for(var n=Object.create(Object.getPrototypeOf(i)),o=Object.keys(i)||r,a=0;a<o.length;a++){var s=o[a];!i.hasOwnProperty(s)||!e.hasOwnProperty(s)||(n[s]=et(i[s],e[s],t))}return n}var h=Math.cos(Math.PI/2*t);return h*i+(1-h)*e}var z=(function(){function i(e,t,r,n){n===void 0&&(n=1),this.r=e,this.g=t,this.b=r,this.a=n}return i.prototype.toString=function(){return"rgba(".concat(this.r,", ").concat(this.g,", ").concat(this.b,", ").concat(this.a,")")},i})(),k=document.createElement("canvas");k.width=k.height=1;var P=k.getContext("2d");function N(i){P.clearRect(0,0,1,1),P.fillStyle=i,P.fillRect(0,0,1,1);var e=P.getImageData(0,0,1,1).data;return new z(e[0],e[1],e[2],e[3]/255)}var rt=(function(){function i(e,t,r,n,o,a,s,h){n===void 0&&(n="normal"),o===void 0&&(o="normal"),a===void 0&&(a="normal"),s===void 0&&(s="normal"),h===void 0&&(h="normal"),this.size=e,this.sizeUnit=t,this.family=r,this.style=n,this.variant=o,this.weight=a,this.stretch=s,this.lineHeight=h}return i.prototype.toString=function(){var e="";return this.style!=="normal"&&(e+=this.style+" "),this.variant!=="normal"&&(e+=this.variant+" "),this.weight!=="normal"&&(e+=this.weight+" "),this.stretch!=="normal"&&(e+=this.stretch+" "),e+="".concat(this.size).concat(this.sizeUnit," "),this.lineHeight!=="normal"&&(e+=this.lineHeight+" "),e+=this.family,e},i})(),F=document.createElement("div");function _t(i){F.setAttribute("style","font: ".concat(i));var e=F.style,t=e.fontSize,r=e.fontFamily,n=e.fontStyle,o=e.fontVariant,a=e.fontWeight,s=e.lineHeight;F.removeAttribute("style");var h=parseFloat(t),u=t.substring(h.toString().length);return new rt(h,u,r,n,o,a,s)}function gt(i,e,t,r,n,o,a,s){s===void 0&&(s=!0),r=r||0,n=n||0,o=o||e.width,a=a||e.height;for(var h=t.getImageData(r,n,o,a),u=0,l=h.data.length;u<l;u+=4)i(h.data,u);s&&t.putImageData(h,r,n)}function G(i){var e=(function(t){d(r,t);function r(n){var o=this,a;if(!n.source)throw new Error('Property "source" is required in options');var s=n.onload;delete n.onload,o=t.call(this,f(f({},n),{duration:(a=n.duration)!==null&&a!==void 0?a:0}))||this,o._initialized=!1,o._sourceStartTime=n.sourceStartTime||0,S(n,o);var h=function(){if(n.duration<0)throw new Error("Invalid options.duration. It must be a non-negative value.");if(o.sourceStartTime>o.source.duration)throw new Error("options.sourceStartTime cannot exceed options.source.duration");o._unstretchedDuration=n.duration||o.source.duration-o.sourceStartTime,o.duration=o._unstretchedDuration/o.playbackRate,s&&s.bind(o)(o.source,n)};return o.source.readyState>=2?h():o.source.addEventListener("loadedmetadata",h),o.source.addEventListener("durationchange",function(){o.duration=n.duration||o.source.duration-o.sourceStartTime}),o}return r.prototype.whenReady=function(){return g(this,void 0,void 0,function(){var n=this;return b(this,function(o){switch(o.label){case 0:return[4,t.prototype.whenReady.call(this)];case 1:return o.sent(),this.source.readyState<4?[4,new Promise(function(a){n.source.addEventListener("canplaythrough",a)})]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},r.prototype.attach=function(n){var o=this;t.prototype.attach.call(this,n),U(n,"audiodestinationupdate",function(a){o.audioNode.disconnect(o._lastAudioDestination),o.audioNode.connect(a.destination),o._lastAudioDestination=a.destination}),this._audioNode=this.audioNode||n.actx.createMediaElementSource(this.source),this.audioNode.connect(n.actx.destination),this._lastAudioDestination=n.actx.destination},r.prototype.detach=function(){var n=this.movie.actx.destination;t.prototype.detach.call(this),this.audioNode.disconnect(n)},r.prototype.start=function(){this.source.currentTime=this.currentTime+this.sourceStartTime,this.source.play()},r.prototype.seek=function(n){t.prototype.seek.call(this,n),isNaN(this.currentTime)?this.source.currentTime=this.sourceStartTime:this.source.currentTime=this.currentTime+this.sourceStartTime},r.prototype.render=function(){t.prototype.render.call(this),this.source.muted=c(this,"muted",this.currentTime),this.source.volume=c(this,"volume",this.currentTime),this.source.playbackRate=c(this,"playbackRate",this.currentTime)},r.prototype.stop=function(){t.prototype.stop.call(this),this.source.pause()},Object.defineProperty(r.prototype,"audioNode",{get:function(){return this._audioNode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(n){this._playbackRate=n,this._unstretchedDuration!==void 0&&(this.duration=this._unstretchedDuration/n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"startTime",{get:function(){return this.__startTime},set:function(n){if(this.__startTime=n,this._initialized){var o=this.movie.currentTime-this.startTime;this.source.currentTime=this.sourceStartTime+o}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sourceStartTime",{get:function(){return this._sourceStartTime},set:function(n){if(this._sourceStartTime=n,this._initialized){var o=this.movie.currentTime-this.startTime;this.source.currentTime=o+this.sourceStartTime}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ready",{get:function(){var n=Object.getOwnPropertyDescriptor(i.prototype,"ready").get.call(this);return n&&this.source.readyState===4},enumerable:!1,configurable:!0}),r.prototype.getDefaultOptions=function(){return f(f({},i.prototype.getDefaultOptions()),{source:void 0,sourceStartTime:0,duration:void 0,muted:!1,volume:1,playbackRate:1})},r})(i);return e}var y=(function(){function i(e){if(e.duration===null||e.duration===void 0)throw new Error('Property "duration" is required in BaseOptions');if(e.startTime===null||e.startTime===void 0)throw new Error('Property "startTime" is required in BaseOptions');this._startTime=e.startTime,this._duration=e.duration,S(e,this),this.active=!1,this.enabled=!0,this._occurrenceCount=0,this._movie=null}return i.prototype.whenReady=function(){return g(this,void 0,void 0,function(){return b(this,function(e){return[2]})})},i.prototype.tryAttach=function(e){this._occurrenceCount===0&&this.attach(e),this._occurrenceCount++},i.prototype.attach=function(e){this._movie=e},i.prototype.tryDetach=function(){if(this.movie===null)throw new Error("No movie to detach from");this._occurrenceCount--,this._occurrenceCount===0&&this.detach()},i.prototype.detach=function(){this._movie=null},i.prototype.start=function(){},i.prototype.seek=function(e){this._currentTime=e},i.prototype.progress=function(e){this._currentTime=e},i.prototype.render=function(){},i.prototype.stop=function(){this._currentTime=void 0},Object.defineProperty(i.prototype,"parent",{get:function(){return this._movie},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},set:function(e){this._duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ready",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"movie",{get:function(){return this._movie},enumerable:!1,configurable:!0}),i.prototype.getDefaultOptions=function(){return{startTime:void 0,duration:void 0}},i})();y.prototype.type="layer";y.prototype.publicExcludes=["active"];y.prototype.propertyFilters={};var it=(function(i){d(e,i);function e(t){if(typeof t.source=="string"){var r=document.createElement("audio");r.src=t.source,t.source=r}return i.call(this,t)||this}return e.prototype.getDefaultOptions=function(){return f(f({},Object.getPrototypeOf(this).getDefaultOptions()),{sourceStartTime:0,duration:void 0})},e})(G(y)),A=(function(){function i(){}return i})(),D=(function(i){d(e,i);function e(t,r){for(var n=i.call(this)||this,o=0,a=t;o<a.length;o++){var s=a[o];r.onAdd(s)}return new Proxy(t,{deleteProperty:function(h,u){var l=h[u];return delete h[u],r.onRemove(l),!0},set:function(h,u,l){var v=h[u];return h[u]=l,isNaN(Number(u))||(v!==void 0&&r.onRemove(v),r.onAdd(l)),!0}})}return e})(Array),bt=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r._layer=t,r}return e.prototype.onAdd=function(t){t.tryAttach(this._layer)},e.prototype.onRemove=function(t){t.tryDetach()},e})(A),Tt=(function(i){d(e,i);function e(t,r){return i.call(this,t,new bt(r))||this}return e})(D),T=(function(i){d(e,i);function e(t){var r=i.call(this,t)||this;return S(t,r),r.canvas=document.createElement("canvas"),r.cctx=r.canvas.getContext("2d"),r.effects=new Tt([],r),r}return e.prototype.whenReady=function(){return g(this,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return[4,i.prototype.whenReady.call(this)];case 1:return t.sent(),[4,Promise.all(this.effects.map(function(r){return r.whenReady()}))];case 2:return t.sent(),[2]}})})},e.prototype.render=function(){var t=c(this,"width",this.currentTime),r=c(this,"height",this.currentTime);t===0||r===0||(this.beginRender(),this.doRender(),this.endRender())},e.prototype.beginRender=function(){this.canvas.width=c(this,"width",this.currentTime),this.canvas.height=c(this,"height",this.currentTime),this.cctx.globalAlpha=c(this,"opacity",this.currentTime)},e.prototype.doRender=function(){this.background&&(this.cctx.fillStyle=c(this,"background",this.currentTime),this.cctx.fillRect(0,0,this.canvas.width,this.canvas.height));var t=c(this,"border",this.currentTime);t&&t.color&&(this.cctx.strokeStyle=t.color,this.cctx.lineWidth=t.thickness||1)},e.prototype.endRender=function(){var t=c(this,"width",this.currentTime)||c(this.movie,"width",this.movie.currentTime),r=c(this,"height",this.currentTime)||c(this.movie,"height",this.movie.currentTime);t*r>0&&this._applyEffects()},e.prototype._applyEffects=function(){for(var t=0;t<this.effects.length;t++){var r=this.effects[t];r&&r.enabled&&r.apply(this,this.movie.currentTime-this.startTime)}},e.prototype.addEffect=function(t){return this.effects.push(t),this},Object.defineProperty(e.prototype,"ready",{get:function(){var t=Object.getOwnPropertyDescriptor(y.prototype,"ready").get.call(this);return t&&this.effects.every(function(r){return r.ready})},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return f(f({},y.prototype.getDefaultOptions()),{x:0,y:0,width:null,height:null,background:null,border:null,opacity:1})},e})(y);T.prototype.publicExcludes=y.prototype.publicExcludes.concat(["canvas","cctx","effects"]);T.prototype.propertyFilters=f(f({},y.prototype.propertyFilters),{width:function(i){return i??this._movie.width},height:function(i){return i??this._movie.height}});function X(i){var e=(function(t){d(r,t);function r(n){var o=this;if(!n.source)throw new Error('Property "source" is required in options');return o=t.call(this,n)||this,S(n,o),o}return r.prototype.whenReady=function(){return g(this,void 0,void 0,function(){var n=this;return b(this,function(o){switch(o.label){case 0:return[4,t.prototype.whenReady.call(this)];case 1:return o.sent(),[4,new Promise(function(a){n.source instanceof HTMLImageElement?n.source.complete?a():n.source.addEventListener("load",function(){a()}):n.source.readyState===4?a():n.source.addEventListener("canplaythrough",function(){a()})})];case 2:return o.sent(),[2]}})})},r.prototype.doRender=function(){t.prototype.doRender.call(this),this.cctx.drawImage(this.source,c(this,"sourceX",this.currentTime),c(this,"sourceY",this.currentTime),c(this,"sourceWidth",this.currentTime),c(this,"sourceHeight",this.currentTime),c(this,"destX",this.currentTime),c(this,"destY",this.currentTime),c(this,"destWidth",this.currentTime),c(this,"destHeight",this.currentTime))},Object.defineProperty(r.prototype,"ready",{get:function(){var n=Object.getOwnPropertyDescriptor(i.prototype,"ready").get.call(this),o=this.source instanceof HTMLImageElement?this.source.complete:this.source.readyState===4;return n&&o},enumerable:!1,configurable:!0}),r.prototype.getDefaultOptions=function(){return f(f({},i.prototype.getDefaultOptions()),{source:void 0,sourceX:0,sourceY:0,sourceWidth:void 0,sourceHeight:void 0,destX:0,destY:0,destWidth:void 0,destHeight:void 0})},r})(i);return e.prototype.propertyFilters=f(f({},T.prototype.propertyFilters),{sourceWidth:function(t){var r=this.source instanceof HTMLImageElement?this.source.width:this.source.videoWidth;return t??r},sourceHeight:function(t){var r=this.source instanceof HTMLImageElement?this.source.height:this.source.videoHeight;return t??r},destWidth:function(t){return t??c(this,"sourceWidth",this.currentTime)},destHeight:function(t){return t??c(this,"sourceHeight",this.currentTime)},width:function(t){return t??c(this,"destWidth",this.currentTime)},height:function(t){return t??c(this,"destHeight",this.currentTime)}}),e}var wt=(function(i){d(e,i);function e(t){if(typeof t.source=="string"){var r=document.createElement("img");r.src=t.source,t.source=r}return i.call(this,t)||this}return e})(X(T)),O=(function(i){return i[i.Inside=0]="Inside",i[i.Center=1]="Center",i[i.Outside=2]="Outside",i})(O||{}),xt=(function(i){d(e,i);function e(t){var r=this;if(!t.text)throw new Error('Property "text" is required in TextOptions');return r=i.call(this,f({background:null},t))||this,S(t,r),r}return e.prototype.doRender=function(){var t,r;i.prototype.doRender.call(this);var n=c(this,"text",this.currentTime),o=c(this,"font",this.currentTime),a=this.maxWidth?c(this,"maxWidth",this.currentTime):void 0;this.cctx.font=o,this.cctx.fillStyle=c(this,"color",this.currentTime),this.cctx.textAlign=c(this,"textAlign",this.currentTime),this.cctx.textBaseline=c(this,"textBaseline",this.currentTime),this.cctx.direction=c(this,"textDirection",this.currentTime),this.cctx.fillText(n,c(this,"textX",this.currentTime),c(this,"textY",this.currentTime),a);var s=c(this,"textStroke",this.currentTime);if(s){this.cctx.strokeStyle=s.color,this.cctx.lineWidth=(t=s.thickness)!==null&&t!==void 0?t:1;var h=(r=s.position)!==null&&r!==void 0?r:"outer",u=this.cctx.globalCompositeOperation;switch(h){case O.Inside:this.cctx.globalCompositeOperation="source-atop",this.cctx.lineWidth*=2;break;case O.Center:break;case O.Outside:this.cctx.globalCompositeOperation="destination-over",this.cctx.lineWidth*=2;break}this.cctx.strokeText(n,c(this,"textX",this.currentTime),c(this,"textY",this.currentTime),a),this.cctx.globalCompositeOperation=u}this._prevText=n,this._prevFont=o,this._prevMaxWidth=a},e.prototype.getDefaultOptions=function(){return f(f({},T.prototype.getDefaultOptions()),{background:null,text:void 0,font:"10px sans-serif",color:N("#fff"),textX:0,textY:0,maxWidth:null,textAlign:"start",textBaseline:"top",textDirection:"ltr",textStroke:null})},e})(T),nt=(function(i){d(e,i);function e(t){var r;if(typeof t.source=="string"){var n=document.createElement("video");n.src=t.source,t.source=n}return i.call(this,f(f({},t),{duration:(r=t.duration)!==null&&r!==void 0?r:0}))||this}return e})(G(X(T))),Et=Object.freeze({__proto__:null,AudioSourceMixin:G,Audio:it,Base:y,Image:wt,Text:xt,get TextStrokePosition(){return O},Video:nt,VisualSourceMixin:X,Visual:T}),C=(function(){function i(){this.enabled=!0,this._occurrenceCount=0,this._target=null}return i.prototype.whenReady=function(){return g(this,void 0,void 0,function(){return b(this,function(e){return[2]})})},i.prototype.tryAttach=function(e){this._occurrenceCount===0&&this.attach(e),this._occurrenceCount++},i.prototype.attach=function(e){this._target=e},i.prototype.tryDetach=function(){if(this._target===null)throw new Error("No movie to detach from");this._occurrenceCount--,this._occurrenceCount===0&&this.detach()},i.prototype.detach=function(){this._target=null},i.prototype.apply=function(e,t){},Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._target?this._target.currentTime:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ready",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"movie",{get:function(){return this._target?this._target.movie:void 0},enumerable:!1,configurable:!0}),i.prototype.getDefaultOptions=function(){return{}},i})();C.prototype.type="effect";C.prototype.publicExcludes=[];C.prototype.propertyFilters={};var R=(function(i){d(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.apply=function(t,r){i.prototype.apply.call(this,t,r)},e})(C),w=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this)||this,n=t.fragmentSource||e._IDENTITY_FRAGMENT_SOURCE,o=t.uniforms||{},a=t.textures||{},s=t.sourceTextureOptions||{},h=r._initGl();return r._program=e._initShaderProgram(h,e._VERTEX_SOURCE,n),r._buffers=e._initRectBuffers(h),r._initTextures(o,a,s),r._initAttribs(),r._initUniforms(o),r}return e.prototype._initGl=function(){this._canvas=document.createElement("canvas");var t=this._canvas.getContext("webgl");if(t===null)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");return this._gl=t,t},e.prototype._initTextures=function(t,r,n){var o=this._gl,a=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS);r.length>a&&console.warn("Too many textures!"),this._userTextures={};for(var s in r){var h=r[s],u=f(f({},e._DEFAULT_TEXTURE_OPTIONS),h);if(u.createUniform){if(t[s])throw new Error("Texture - uniform naming conflict: ".concat(s,"!"));t[s]="1i"}this._userTextures[s]=u}this._sourceTextureOptions=f(f({},e._DEFAULT_TEXTURE_OPTIONS),n)},e.prototype._initAttribs=function(){var t=this._gl;this._attribLocations={textureCoord:t.getAttribLocation(this._program,"a_TextureCoord")}},e.prototype._initUniforms=function(t){var r=this._gl;this._uniformLocations={source:r.getUniformLocation(this._program,"u_Source"),size:r.getUniformLocation(this._program,"u_Size")},this._userUniforms={};for(var n in t){var o=t[n];this._userUniforms[n]=typeof o=="string"?{type:o}:o}for(var a in t){var s="u_"+a.charAt(0).toUpperCase()+(a.length>1?a.slice(1):"");this._uniformLocations[a]=r.getUniformLocation(this._program,s)}},e.prototype.apply=function(t,r){this._checkDimensions(t),this._refreshGl(),this._enablePositionAttrib(),this._enableTexCoordAttrib(),this._prepareTextures(t,r),this._gl.useProgram(this._program),this._prepareUniforms(t,r),this._draw(t)},e.prototype._checkDimensions=function(t){var r=this._gl;(this._canvas.width!==t.canvas.width||this._canvas.height!==t.canvas.height)&&(this._canvas.width=t.canvas.width,this._canvas.height=t.canvas.height,r.viewport(0,0,t.canvas.width,t.canvas.height))},e.prototype._refreshGl=function(){var t=this._gl;t.clearColor(0,0,0,1),t.blendFuncSeparate(t.SRC_ALPHA,t.SRC_ALPHA,t.ONE,t.ZERO),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype._enablePositionAttrib=function(){var t=this._gl,r=2,n=t.FLOAT,o=!1,a=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this._buffers.position),t.vertexAttribPointer(this._attribLocations.vertexPosition,r,n,o,a,s),t.enableVertexAttribArray(this._attribLocations.vertexPosition)},e.prototype._enableTexCoordAttrib=function(){var t=this._gl,r=2,n=t.FLOAT,o=!1,a=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this._buffers.textureCoord),t.vertexAttribPointer(this._attribLocations.textureCoord,r,n,o,a,s),t.enableVertexAttribArray(this._attribLocations.textureCoord)},e.prototype._prepareTextures=function(t,r){var n=this._gl;n.activeTexture(n.TEXTURE0),this._inputTexture=e._loadTexture(n,t.canvas,this._sourceTextureOptions),n.bindTexture(n.TEXTURE_2D,this._inputTexture);var o=0;for(var a in this._userTextures){var s=this._userTextures[a];n.activeTexture(n.TEXTURE0+(e.INTERNAL_TEXTURE_UNITS+o));var h=e._loadTexture(n,c(this,a,r),s);n.bindTexture(n[s.target],h),o++}},e.prototype._prepareUniforms=function(t,r){var n=this._gl;this._uniformLocations.source&&n.uniform1i(this._uniformLocations.source,0),this._uniformLocations.size&&n.uniform2iv(this._uniformLocations.size,[t.canvas.width,t.canvas.height]);for(var o in this._userUniforms){var a=this._userUniforms[o],s=c(this,o,r),h=this._prepareValue(s,a.type,r,a),u=this._uniformLocations[o];n["uniform"+a.type](u,h)}n.uniform1i(this._uniformLocations.test,0)},e.prototype._draw=function(t){var r=this._gl,n=0,o=4;r.drawArrays(r.TRIANGLE_STRIP,n,o),t.cctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.cctx.drawImage(this._canvas,0,0)},e.prototype._prepareValue=function(t,r,n,o){o===void 0&&(o={});var a=o.defaultFloatComponent||0;if(r==="1i"){var s=0;for(var h in this._userTextures){var u=c(this,h,n);t===u&&(t=e.INTERNAL_TEXTURE_UNITS+s),s++}}if(r==="3fv"){if(Array.isArray(t)&&(t.length===3||t.length===4))return t;if(typeof t=="object")return[t.r!==void 0?t.r:a,t.g!==void 0?t.g:a,t.b!==void 0?t.b:a];throw new Error("Invalid type: ".concat(r," or value: ").concat(t))}if(r==="4fv"){if(Array.isArray(t)&&t.length===4)return t;if(typeof t=="object")return[t.r!==void 0?t.r:a,t.g!==void 0?t.g:a,t.b!==void 0?t.b:a,t.a!==void 0?t.a:a];throw new Error("Invalid type: ".concat(r," or value: ").concat(t))}return t},e._initRectBuffers=function(t){var r=[-1,1,1,1,-1,-1,1,-1],n=[0,0,1,0,0,1,1,1];return{position:e._initBuffer(t,r),textureCoord:e._initBuffer(t,n)}},e._initBuffer=function(t,r){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),n},e._loadTexture=function(t,r,n){n===void 0&&(n={}),n=f(f({},e._DEFAULT_TEXTURE_OPTIONS),n);var o=t[n.target],a=n.level,s=t[n.internalFormat],h=t[n.srcFormat],u=t[n.srcType],l=t[n.wrapS],v=t[n.wrapT],M=t[n.minFilter],L=t[n.magFilter],H=t.createTexture();t.bindTexture(o,H),t.texImage2D(o,a,s,h,u,r);var Y=o instanceof HTMLVideoElement?o.videoWidth:o.width,K=o instanceof HTMLVideoElement?o.videoHeight:o.height;return t.texParameteri(o,t.TEXTURE_MIN_FILTER,M),t.texParameteri(o,t.TEXTURE_MAG_FILTER,L),Y&&$(Y)&&K&&$(K)?(t.texParameteri(o,t.TEXTURE_WRAP_S,l),t.texParameteri(o,t.TEXTURE_WRAP_T,v),t.generateMipmap(o)):((l!==t.CLAMP_TO_EDGE||v!==t.CLAMP_TO_EDGE)&&console.warn("Wrap mode is not CLAMP_TO_EDGE for a non-power-of-two texture. Defaulting to CLAMP_TO_EDGE"),t.texParameteri(o,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(o,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),H},e._initShaderProgram=function(t,r,n){var o=e._loadShader(t,t.VERTEX_SHADER,r),a=e._loadShader(t,t.FRAGMENT_SHADER,n),s=t.createProgram();return t.attachShader(s,o),t.attachShader(s,a),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?s:(console.warn("Unable to link shader program: "+t.getProgramInfoLog(s)),null)},e._loadShader=function(t,r,n){var o=t.createShader(r);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(console.warn("An error occured compiling shader: "+t.getShaderInfoLog(o)),t.deleteShader(o),null)},e.INTERNAL_TEXTURE_UNITS=1,e._DEFAULT_TEXTURE_OPTIONS={createUniform:!0,target:"TEXTURE_2D",level:0,internalFormat:"RGBA",srcFormat:"RGBA",srcType:"UNSIGNED_BYTE",minFilter:"LINEAR",magFilter:"LINEAR",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"},e._VERTEX_SOURCE=`
    attribute vec4 a_VertexPosition;
    attribute vec2 a_TextureCoord;

    varying highp vec2 v_TextureCoord;

    void main() {
        // no need for projection or model-view matrices, since we're just rendering a rectangle
        // that fills the screen (see position values)
        gl_Position = a_VertexPosition;
        v_TextureCoord = a_TextureCoord;
    }
  `,e._IDENTITY_FRAGMENT_SOURCE=`
    precision mediump float;

    uniform sampler2D u_Source;

    varying highp vec2 v_TextureCoord;

    void main() {
        gl_FragColor = texture2D(u_Source, v_TextureCoord);
    }
  `,e})(R),$=function(i){return(i&&i-1)===0},St=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform float u_Brightness;

        varying highp vec2 v_TextureCoord;

        void main() {
          vec4 color = texture2D(u_Source, v_TextureCoord);
          vec3 rgb = clamp(color.rgb + u_Brightness / 255.0, 0.0, 1.0);
          gl_FragColor = vec4(rgb, color.a);
        }
      `,uniforms:{brightness:"1f"}})||this;return r.brightness=t.brightness||0,r}return e})(w),Ot=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform vec4 u_Factors;

        varying highp vec2 v_TextureCoord;

        void main() {
          vec4 color = texture2D(u_Source, v_TextureCoord);
          gl_FragColor = clamp(u_Factors * color, 0.0, 1.0);
        }
      `,uniforms:{factors:{type:"4fv",defaultFloatComponent:1}}})||this;return r.factors=t.factors||{},r}return e})(w),Ct=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform vec3 u_Target;
        uniform float u_Threshold;
        uniform bool u_Interpolate;

        varying highp vec2 v_TextureCoord;

        void main() {
          vec4 color = texture2D(u_Source, v_TextureCoord);
          float alpha = color.a;
          vec3 dist = abs(color.rgb - u_Target / 255.0);
          if (!u_Interpolate) {
            // Standard way that most video editors probably use (all-or-nothing method)
            float thresh = u_Threshold / 255.0;
            bool transparent = dist.r <= thresh && dist.g <= thresh && dist.b <= thresh;
            if (transparent)
              alpha = 0.0;
          } else {
            /*
             better way IMHO:
             Take the average of the absolute differences between the pixel and the target for each channel
             */
            float transparency = (dist.r + dist.g + dist.b) / 3.0;
            // TODO: custom or variety of interpolation methods
            alpha = transparency;
          }
          gl_FragColor = vec4(color.rgb, alpha);
        }
      `,uniforms:{target:"3fv",threshold:"1f",interpolate:"1i"}})||this;return r.target=t.target||new z(0,0,0),r.threshold=t.threshold||0,r.interpolate=t.interpolate||!1,r}return e})(w),Rt=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform float u_Contrast;

        varying highp vec2 v_TextureCoord;

        void main() {
          vec4 color = texture2D(u_Source, v_TextureCoord);
          vec3 rgb = clamp(u_Contrast * (color.rgb - 0.5) + 0.5, 0.0, 1.0);
          gl_FragColor = vec4(rgb, color.a);
        }
      `,uniforms:{contrast:"1f"}})||this;return r.contrast=t.contrast||1,r}return e})(w),Pt=(function(){function i(){}return i})(),At=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r.x=t.x,r.y=t.y,r.radiusX=t.radiusX,r.radiusY=t.radiusY,r.rotation=t.rotation||0,r.startAngle=t.startAngle||0,r.endAngle=t.endAngle!==void 0?t.endAngle:2*Math.PI,r.anticlockwise=t.anticlockwise||!1,r._tmpCanvas=document.createElement("canvas"),r._tmpCtx=r._tmpCanvas.getContext("2d"),r}return e.prototype.apply=function(t,r){var n=t.cctx,o=t.canvas,a=c(this,"x",r),s=c(this,"y",r),h=c(this,"radiusX",r),u=c(this,"radiusY",r),l=c(this,"rotation",r),v=c(this,"startAngle",r),M=c(this,"endAngle",r),L=c(this,"anticlockwise",r);this._tmpCanvas.width=t.canvas.width,this._tmpCanvas.height=t.canvas.height,this._tmpCtx.drawImage(o,0,0),n.clearRect(0,0,o.width,o.height),n.save(),n.beginPath(),n.ellipse(a,s,h,u,l,v,M,L),n.closePath(),n.clip(),n.drawImage(this._tmpCanvas,0,0),n.restore()},e})(R),Dt=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r._stack=t,r}return e.prototype.onAdd=function(t){this._stack.parent&&t.tryAttach(this._stack.parent)},e.prototype.onRemove=function(t){this._stack.parent&&t.tryDetach()},e})(A),Mt=(function(i){d(e,i);function e(t,r){return i.call(this,t,new Dt(r))||this}return e})(D),ot=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r.effects=new Mt(t.effects,r),t.effects.forEach(function(n){return r.effects.push(n)}),r}return e.prototype.attach=function(t){i.prototype.attach.call(this,t),this.effects.filter(function(r){return!!r}).forEach(function(r){r.tryAttach(t)})},e.prototype.detach=function(){i.prototype.detach.call(this),this.effects.filter(function(t){return!!t}).forEach(function(t){t.tryDetach()})},e.prototype.apply=function(t,r){for(var n=0;n<this.effects.length;n++){var o=this.effects[n];o&&o.apply(t,r)}},e.prototype.addEffect=function(t){return this.effects.push(t),this},e})(R),Lt=(function(i){d(e,i);function e(t){return i.call(this,{effects:[new at(t),new st(t)]})||this}return e})(ot),W=(function(i){d(e,i);function e(t){var r=i.call(this,{fragmentSource:t.fragmentSource,uniforms:{radius:"1i"},textures:{shape:{minFilter:"NEAREST",magFilter:"NEAREST"}}})||this;return r.radius=t.radius,r._radiusCache=void 0,r}return e.prototype.apply=function(t,r){var n=c(this,"radius",r);n!==this._radiusCache&&(this.shape=e._render1DKernel(e._gen1DKernel(n))),this._radiusCache=n,i.prototype.apply.call(this,t,r)},e._render1DKernel=function(t){var r=document.createElement("canvas");r.width=t.length,r.height=1;for(var n=r.getContext("2d"),o=n.createImageData(r.width,r.height),a=0;a<t.length;a++)o.data[4*a+0]=255*t[a],o.data[4*a+1]=0,o.data[4*a+2]=0,o.data[4*a+3]=255;return n.putImageData(o,0,0),r},e._gen1DKernel=function(t){for(var r=e._genPascalRow(2*t+1),n=0,o=0;o<r.length;o++)n+=r[o];for(var o=0;o<r.length;o++)r[o]/=n;return r},e._genPascalRow=function(t){if(t<0)throw new Error("Invalid index ".concat(t));for(var r=[1],n=1;n<t;n++){var o=[];o.length=r.length+1,o[0]=o[o.length-1]=1;for(var a=1;a<o.length-1;a++)o[a]=r[a-1]+r[a];r=o}return r},e})(w);W.prototype.publicExcludes=w.prototype.publicExcludes.concat(["shape"]);var at=(function(i){d(e,i);function e(t){return i.call(this,{fragmentSource:`
        #define MAX_RADIUS 250

        precision mediump float;

        uniform sampler2D u_Source;
        uniform ivec2 u_Size;   // pixel dimensions of input and output
        uniform sampler2D u_Shape;  // pseudo one-dimension of blur distribution (would be 1D but webgl doesn't support it)
        uniform int u_Radius;   // TODO: support floating-point radii

        varying highp vec2 v_TextureCoord;

        void main() {
          /*
           * Ideally, totalWeight should end up being 1, but due to rounding errors, it sometimes ends up less than 1
           * (I believe JS canvas stores values as integers, which rounds down for the majority of the Gaussian curve)
           * So, normalize by accumulating all the weights and dividing by that.
           */
          float totalWeight = 0.0;
          vec4 avg = vec4(0.0);
          // GLSL can only use constants in for-loop declaration, so start at zero, and stop before 2 * u_Radius + 1,
          // opposed to starting at -u_Radius and stopping _at_ +u_Radius.
          for (int i = 0; i < 2 * MAX_RADIUS + 1; i++) {
            if (i >= 2 * u_Radius + 1)
              break;  // GLSL can only use constants in for-loop declaration, so we break here.
            // (2 * u_Radius + 1) is the width of u_Shape, by definition
            float weight = texture2D(u_Shape, vec2(float(i) / float(2 * u_Radius + 1), 0.5)).r;   // TODO: use single-channel format
            totalWeight += weight;
            vec4 sample = texture2D(u_Source, v_TextureCoord + vec2(i - u_Radius, 0.0) / vec2(u_Size));
            avg += weight * sample;
          }
          gl_FragColor = avg / totalWeight;
        }
      `,radius:t.radius})||this}return e})(W),st=(function(i){d(e,i);function e(t){return i.call(this,{fragmentSource:`
        #define MAX_RADIUS 250

        precision mediump float;

        uniform sampler2D u_Source;
        uniform ivec2 u_Size;   // pixel dimensions of input and output
        uniform sampler2D u_Shape;  // pseudo one-dimension of blur distribution (would be 1D but webgl doesn't support it)
        uniform int u_Radius;   // TODO: support floating-point radii

        varying highp vec2 v_TextureCoord;

        void main() {
          /*
           * Ideally, totalWeight should end up being 1, but due to rounding errors, it sometimes ends up less than 1
           * (I believe JS canvas stores values as integers, which rounds down for the majority of the Gaussian curve)
           * So, normalize by accumulating all the weights and dividing by that.
           */
          float totalWeight = 0.0;
          vec4 avg = vec4(0.0);
          // GLSL can only use constants in for-loop declaration, so start at zero, and stop before 2 * u_Radius + 1,
          // opposed to starting at -u_Radius and stopping _at_ +u_Radius.
          for (int i = 0; i < 2 * MAX_RADIUS + 1; i++) {
            if (i >= 2 * u_Radius + 1)
              break;  // GLSL can only use constants in for-loop declaration, so we break here.
            // (2 * u_Radius + 1) is the width of u_Shape, by definition
            float weight = texture2D(u_Shape, vec2(float(i) / float(2 * u_Radius + 1), 0.5)).r;   // TODO: use single-channel format
            totalWeight += weight;
            vec4 sample = texture2D(u_Source, v_TextureCoord + vec2(0.0, i - u_Radius) / vec2(u_Size));
            avg += weight * sample;
          }
          gl_FragColor = avg / totalWeight;
        }
      `,radius:t.radius})||this}return e})(W),Ft=(function(i){d(e,i);function e(){return i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform vec4 u_Factors;

        varying highp vec2 v_TextureCoord;

        float max3(float x, float y, float z) {
          return max(x, max(y, z));
        }

        float min3(float x, float y, float z) {
          return min(x, min(y, z));
        }

        void main() {
          vec4 color = texture2D(u_Source, v_TextureCoord);
          // Desaturate
          float value = (max3(color.r, color.g, color.b) + min3(color.r, color.g, color.b)) / 2.0;
          gl_FragColor = vec4(value, value, value, color.a);
        }
      `})||this}return e})(w),It=(function(i){d(e,i);function e(t){t===void 0&&(t={});var r=i.call(this,{fragmentSource:`
        precision mediump float;

        uniform sampler2D u_Source;
        uniform ivec2 u_Size;
        uniform int u_PixelSize;

        varying highp vec2 v_TextureCoord;

        void main() {
          int ps = u_PixelSize;

          // Snap to nearest block's center
          vec2 loc = vec2(u_Size) * v_TextureCoord; // pixel-space
          vec2 snappedLoc = float(ps) * floor(loc / float(ps));
          vec2 centeredLoc = snappedLoc + vec2(float(u_PixelSize) / 2.0 + 0.5);
          vec2 clampedLoc = clamp(centeredLoc, vec2(0.0), vec2(u_Size));
          gl_FragColor = texture2D(u_Source, clampedLoc / vec2(u_Size));
        }
      `,uniforms:{pixelSize:"1i"}})||this;return r.pixelSize=t.pixelSize||1,r}return e.prototype.apply=function(t,r){var n=c(this,"pixelSize",r);if(n%1!==0||n<0)throw new Error("Pixel size must be a nonnegative integer");i.prototype.apply.call(this,t,r)},e})(w),j=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r.matrix=t.matrix,r._tmpMatrix=new e.Matrix,r._tmpCanvas=document.createElement("canvas"),r._tmpCtx=r._tmpCanvas.getContext("2d"),r}return e.prototype.apply=function(t,r){t.canvas.width!==this._tmpCanvas.width&&(this._tmpCanvas.width=t.canvas.width),t.canvas.height!==this._tmpCanvas.height&&(this._tmpCanvas.height=t.canvas.height),this._tmpMatrix.data=c(this,"matrix",r).data,this._tmpCtx.setTransform(this._tmpMatrix.a,this._tmpMatrix.b,this._tmpMatrix.c,this._tmpMatrix.d,this._tmpMatrix.e,this._tmpMatrix.f),this._tmpCtx.drawImage(t.canvas,0,0),this._tmpCtx.setTransform(1,0,0,0,1,0),t.cctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.cctx.drawImage(this._tmpCanvas,0,0)},e})(R);(function(i){var e=(function(){function t(r){this.data=r||[1,0,0,0,1,0,0,0,1]}return t.prototype.identity=function(){for(var r=0;r<this.data.length;r++)this.data[r]=t.IDENTITY.data[r];return this},t.prototype.cell=function(r,n,o){return o!==void 0&&(this.data[3*n+r]=o),this.data[3*n+r]},Object.defineProperty(t.prototype,"a",{get:function(){return this.data[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.data[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"c",{get:function(){return this.data[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"d",{get:function(){return this.data[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"e",{get:function(){return this.data[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f",{get:function(){return this.data[5]},enumerable:!1,configurable:!0}),t.prototype.multiply=function(r){for(var n=0;n<3;n++)for(var o=0;o<3;o++){for(var a=0,s=0;s<3;s++)a+=this.cell(n,s)*r.cell(s,o);t._TMP_MATRIX.cell(n,o,a)}for(var s=0;s<t._TMP_MATRIX.data.length;s++)this.data[s]=t._TMP_MATRIX.data[s];return this},t.prototype.translate=function(r,n){return this.multiply(new t([1,0,r,0,1,n,0,0,1])),this},t.prototype.scale=function(r,n){return this.multiply(new t([r,0,0,0,n,0,0,0,1])),this},t.prototype.rotate=function(r){var n=Math.cos(r),o=Math.sin(r);return this.multiply(new t([n,o,0,-o,n,0,0,0,1])),this},t.IDENTITY=new t,t._TMP_MATRIX=new t,t})();i.Matrix=e})(j||(j={}));var kt=Object.freeze({__proto__:null,Base:C,Brightness:St,Channels:Ot,ChromaKey:Ct,Contrast:Rt,EllipticalMaskOptions:Pt,EllipticalMask:At,GaussianBlur:Lt,GaussianBlurHorizontal:at,GaussianBlurVertical:st,Grayscale:Ft,Pixelate:It,Shader:w,Stack:ot,get Transform(){return j},Visual:R}),jt=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r._movie=t,r}return e.prototype.onAdd=function(t){t.tryAttach(this._movie)},e.prototype.onRemove=function(t){t.tryDetach()},e})(A),Ut=(function(i){d(e,i);function e(t,r){return i.call(this,t,new jt(r))||this}return e})(D),Bt=(function(i){d(e,i);function e(t){var r=i.call(this)||this;return r._movie=t,r}return e.prototype.onAdd=function(t){t.tryAttach(this._movie)},e.prototype.onRemove=function(t){t.tryDetach()},e})(A),zt=(function(i){d(e,i);function e(t,r){return i.call(this,t,new Bt(r))||this}return e})(D),Nt=(function(){function i(){}return i})(),V=(function(){function i(e){if(this._recording=!1,this.actx=e.actx||e.audioContext||new AudioContext||new window.webkitAudioContext,delete e.actx,!e.canvas)throw new Error('Required option "canvas" not provided to Movie');this._canvas=this._visibleCanvas=e.canvas,delete e.canvas,this._cctx=this.canvas.getContext("2d"),S(e,this),this.effects=new Ut([],this),this.layers=new zt([],this),this._paused=!0,this._ended=!1,this._renderingFrame=!1,this.currentTime=0}return i.prototype._whenReady=function(){return g(this,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,Promise.all([Promise.all(this.layers.map(function(t){return t.whenReady()})),Promise.all(this.effects.map(function(t){return t.whenReady()}))])];case 1:return e.sent(),[2]}})})},i.prototype.play=function(e){var t;return e===void 0&&(e={}),g(this,void 0,void 0,function(){var r=this;return b(this,function(n){switch(n.label){case 0:return[4,this._whenReady()];case 1:if(n.sent(),!this.paused)throw new Error("Already playing");return this._paused=this._ended=!1,this._lastRealTime=performance.now(),this._endTime=e.duration?this.currentTime+e.duration:this.duration,(t=e.onStart)===null||t===void 0||t.call(e),p(this,"movie.play",{}),[4,new Promise(function(o){r.renderingFrame||r._render(void 0,o),r._renderingFrame=!1})];case 2:return n.sent(),this._lastRealTime=void 0,[2]}})})},i.prototype._show=function(){this._canvas=this._visibleCanvas,this._cctx=this.canvas.getContext("2d"),p(this,"audiodestinationupdate",{movie:this,destination:this.actx.destination})},i.prototype.stream=function(e){return g(this,void 0,void 0,function(){var t,r,n,o,a,s=this;return b(this,function(h){switch(h.label){case 0:if(!e||!e.frameRate)throw new Error('Required option "frameRate" not provided to Movie.stream');if(e.video===!1&&e.audio===!1)throw new Error("Both video and audio cannot be disabled");if(!this.paused)throw new Error("Cannot stream movie while it's already playing");return[4,this._whenReady()];case 1:return h.sent(),this._canvas=document.createElement("canvas"),this.canvas.width=this._visibleCanvas.width,this.canvas.height=this._visibleCanvas.height,this._cctx=this.canvas.getContext("2d"),t=[],e.video!==!1&&(r=this.canvas.captureStream(e.frameRate),t=t.concat(r.getTracks())),n=this.layers.some(function(u){return u instanceof it||u instanceof nt}),n&&e.audio!==!1&&(o=this.actx.createMediaStreamDestination(),a=o.stream,t=t.concat(a.getTracks()),p(this,"audiodestinationupdate",{movie:this,destination:o})),this._currentStream=new MediaStream(t),[4,this.play({onStart:function(){e.onStart(s._currentStream)},duration:e.duration})];case 2:return h.sent(),this._currentStream.getTracks().forEach(function(u){u.stop()}),this._currentStream=null,this._show(),[2]}})})},i.prototype.record=function(e){var t;return g(this,void 0,void 0,function(){var r,n,o,a,s=this;return b(this,function(h){switch(h.label){case 0:if(e.video===!1&&e.audio===!1)throw new Error("Both video and audio cannot be disabled");if(!this.paused)throw new Error("Cannot record movie while it's already playing");if(r=e.type||"video/webm",MediaRecorder&&MediaRecorder.isTypeSupported&&!MediaRecorder.isTypeSupported(r))throw new Error("Please pass a valid MIME type for the exported video");return[4,new Promise(function(u){s.stream({frameRate:e.frameRate,duration:e.duration,video:e.video,audio:e.audio,onStart:u}).then(function(){s._recorder.requestData(),s._recorder.stop()})})];case 1:return n=h.sent(),o=[],a=f(f({},e.mediaRecorderOptions||{}),{mimeType:r}),this._recorder=new MediaRecorder(n,a),this._recorder.ondataavailable=function(u){u.data.size>0&&o.push(u.data)},this._recorder.start(),this._recording=!0,(t=e.onStart)===null||t===void 0||t.call(e,this._recorder),p(this,"movie.record",{options:e}),[4,new Promise(function(u,l){s._recorder.onstop=function(){u()},s._recorder.onerror=l})];case 2:return h.sent(),this._paused=!0,this._ended=!0,this._recording=!1,[2,new Blob(o,{type:r})]}})})},i.prototype.pause=function(){this._paused=!0;for(var e=0;e<this.layers.length;e++)if(Object.prototype.hasOwnProperty.call(this.layers,e)){var t=this.layers[e];t.active&&(t.stop(),t.active=!1)}return p(this,"movie.pause",{}),this},i.prototype.stop=function(){return this.pause(),this.currentTime=0,this},i.prototype._render=function(e,t){var r=this;if(e===void 0&&(e=performance.now()),t===void 0&&(t=void 0),Q(this),!this.rendering){t&&t();return}if(this.ready){p(this,"movie.loadeddata",{movie:this}),this._recording&&this._recorder.state==="paused"&&this._recorder.resume();var n=this._currentStream?this._endTime:this.duration;if(this._updateCurrentTime(e,n),this.currentTime===n&&(this.recording&&p(this,"movie.recordended",{movie:this}),this.currentTime===this.duration&&p(this,"movie.ended",{movie:this,repeat:this.repeat}),this._currentTime=0,p(this,"movie.timeupdate",{movie:this}),this._renderingFrame=!1,!(!this.recording&&this.repeat))){this._paused=!0,this._ended=!0;for(var o=0;o<this.layers.length;o++)if(Object.prototype.hasOwnProperty.call(this.layers,o)){var a=this.layers[o];if(!a||!a.active)continue;a.stop(),a.active=!1}p(this,"movie.pause",{}),t&&t();return}this._renderBackground(e),this._renderLayers(),this._applyEffects()}else this.recording&&this._recorder.state==="recording"&&this._recorder.pause();if(this._renderingFrame&&this.ready){this._renderingFrame=!1,t&&t();return}window.requestAnimationFrame(function(){r._render(void 0,t)})},i.prototype._updateCurrentTime=function(e,t){if(!this._renderingFrame){var r=e/1e3,n=r-this._lastRealTime;this._lastRealTime=r,n>0&&(this._currentTime+=n,p(this,"movie.timeupdate",{movie:this})),this.currentTime>t&&(this._currentTime=t)}},i.prototype._renderBackground=function(e){this.cctx.clearRect(0,0,this.canvas.width,this.canvas.height);var t=c(this,"background",e);t&&(this.cctx.fillStyle=t,this.cctx.fillRect(0,0,this.canvas.width,this.canvas.height))},i.prototype._renderLayers=function(){for(var e=0;e<this.layers.length;e++)if(Object.prototype.hasOwnProperty.call(this.layers,e)){var t=this.layers[e];if(t){var r=this.currentTime-t.startTime;if(!c(t,"enabled",r)||this.currentTime<t.startTime||this.currentTime>t.startTime+t.duration){t.active&&!this._renderingFrame&&(t.stop(),t.active=!1);continue}if(this._renderingFrame||t.progress(r),!t.active&&c(t,"enabled",r)&&!this._renderingFrame&&(t.start(),t.active=!0),t.render(),t instanceof T){var n=t.canvas;n.width*n.height>0&&this.cctx.drawImage(n,c(t,"x",r),c(t,"y",r),n.width,n.height)}}}},i.prototype._applyEffects=function(){for(var e=0;e<this.effects.length;e++){var t=this.effects[e];t&&t.apply(this,this.currentTime)}},i.prototype.refresh=function(){var e=this;if(!this.paused)throw new Error("Already playing");return new Promise(function(t){e._renderingFrame=!0,e._render(void 0,t)})},i.prototype._publishToLayers=function(e,t){for(var r=0;r<this.layers.length;r++)Object.prototype.hasOwnProperty.call(this.layers,r)&&p(this.layers[r],e,t)},Object.defineProperty(i.prototype,"rendering",{get:function(){return!this.paused||this._renderingFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingFrame",{get:function(){return this._renderingFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"recording",{get:function(){return this._recording},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this.layers.reduce(function(e,t){return Math.max(t.startTime+t.duration,e)},0)},enumerable:!1,configurable:!0}),i.prototype.addLayer=function(e){return this.layers.push(e),this},i.prototype.addEffect=function(e){return this.effects.push(e),this},Object.defineProperty(i.prototype,"paused",{get:function(){return this._paused},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),i.prototype.seek=function(e){this._currentTime=e;for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r){var n=e-r.startTime;n>=0&&n<=r.duration?r.seek(n):r.seek(void 0)}}p(this,"movie.seek",{})},Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},set:function(e){this.seek(e)},enumerable:!1,configurable:!0}),i.prototype.setCurrentTime=function(e,t){var r=this;return t===void 0&&(t=!0),new Promise(function(n,o){r.seek(e),t?r.refresh().then(n).catch(o):n()})},Object.defineProperty(i.prototype,"ready",{get:function(){var e=this.layers.every(function(r){return r.ready}),t=this.effects.every(function(r){return r.ready});return e&&t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cctx",{get:function(){return this._cctx},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"movie",{get:function(){return this},enumerable:!1,configurable:!0}),i.prototype.getDefaultOptions=function(){return{canvas:void 0,background:N("#000"),repeat:!1}},i})();V.prototype.type="movie";V.prototype.propertyFilters={};_("movie.audiodestinationupdate","audiodestinationupdate");_("movie.ended",void 0);_("movie.loadeddata",void 0);_("movie.pause",void 0,"Wait for `play()`, `stream()`, or `record()` to resolve instead.");_("movie.play",void 0,"Provide an `onStart` callback to `play()`, `stream()`, or `record()` instead.");_("movie.record",void 0,"Provide an `onStart` callback to `record()` instead.");_("movie.recordended",void 0,"Wait for `record()` to resolve instead.");_("movie.seek",void 0,"Override the `seek` method on layers instead.");_("movie.timeupdate",void 0,"Override the `progress` method on layers instead.");var Gt=Object.freeze({__proto__:null,layer:Et,effect:kt,event:lt,MovieOptions:Nt,Movie:V,applyOptions:S,clearCachedValues:Q,KeyFrame:tt,val:c,linearInterp:B,cosineInterp:et,Color:z,parseColor:N,Font:rt,parseFont:_t,mapPixels:gt});ut.exports=Gt});export default Xt();
